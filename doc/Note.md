# AXF

## 架构分析
- 用户中心
- 首页商品展示
- 闪购（商品列表）
- 购物车
   - 订单系统
   - 收货地址
   - 支付
   - 优惠券
   - 积分系统
   - vip
   - 评价系统
   - 物流
   - 判决系统
   - 黑名单系统
   
   
   
### 开发过程
- 首页，闪购，个人模块可以并行开发
- 从最简单的开始



#### 个人中心
- 和用户系统相关联
    - 用户动作
        - 注册
        - 登录
        - 退出
        - 用户信息修改
    - 订单
        - 订单状态
    - 积分
    - 收货地址
    

#### 用户系统
- 设计用户表
    - id
    - 用户名
    - 密码
    - 性别
    - 邮箱
    - 头像
    - 逻辑删除
    
    
#### 提升用户体验
- 注册的时候，进行用户名的预校验
    - 使用ajax和服务器进行交互
    - JSON数据格式
    
    
    
#### 购物车设计
- 购物车中的数据
    - 商品信息
    - 用户信息
- 手动实现多对多
    - 两个外键
    - 两个外键分别指向两个关键表的主键
- 表字段设计
    - id
    - user_id
    - goods_id
    - number
    - is_select
    
    
#### 订单
- 当点击下单的时候，将所有选中的商品提交给服务器生成一个订单
- 订单信息
    - 订单编号
    - 订单和用户关系
        - 用户和订单是一对多  ForeignKey
    - 订单中存放商品信息
        - 一个订单对应多个商品 ForeignKey
    - 订单状态
        - 状态码
- 表设计
    - OrderModel
        - id
        - user_id
        - goods_id(不会出现)
        - status
        - order_num
        - create_time
    - OrderGoodsModel
        - id
        - goods_id
        - order_id
        - goods_num
    


#### 项目总结
- Django实现
- MTV架构体系
    - Models 模型，用来和数据库的交互（ORM），显性属性，隐形属性
    - Templates 模板，html+模板语言（Django），模板语言最终也是HTML
    - Views 视图函数，接收用户请求，协调模型和模板，最终给用户做一个返回
- 项目分析
    - 半逆向的工程
    - 分析原型图
        - 主页面分为四大模块
            - 首页，主要用来展示
            - 闪购，三级联动商品列表
            - 购物车 
            - 我的，个人中心
    
- 撸代码
    - 创建通用项目
        - 创建好自己的应用
        - 配置所需要的各种环境，各种信息
            - 模板路径
            - 静态资源
            - 数据库
            - 媒体根目录
            - 中间件
                - 反爬（×××）
            - 语言时区
            - 缓存
    - 封装自己的模块
        - 按功能划分文件夹
        - 封装各自的base  
    - 开发
        - 从模型开始
            - 分析需求，建模
        - 页面展示，数据查询
            - 在views实现数据查询，对数据筛选，对数据进行过滤，处理
            - 将数据传递到模板中
        - 渲染模板
            - 弱化样式
            - 熟练使用常见标签
            - 掌握JS交互逻辑
         - 注册路由
            - 参数传递
            - 针对相同视图函数有参数和无参数的，需要添加统一方式，重定向一个
- 具体实现
    - 首页
        - 就是几个查询
    - 闪购
        - 数据显示
        - 对数据添加过滤条件
            - filter
                - 左侧大类的过滤
                - 级联子类过滤
            - order_by 
                - 排序字段
        - 数据转换
            - 数据不能直接使用或存储的时候，需要我们进行转换
    - 我的
        - 注册
            - 定义模型字段
                - id
                - 名字 （唯一）
                - 密码   （数据安全） sha
                - 邮箱  （唯一）
                - 逻辑删除
                - 头像   （ImageField）
            - 视图函数
                - 展示注册页面
                    - 提供和服务器交互的form表单
                        - 请求方式，需要设置为post
                        - 文件上传 添加enctype="multipart/form-data"
                        - onsubmit 在提交时触发
                            - 预校验
                            - 实现数据安全 md5
                        - 提交地址
                - 处理注册的post请求
                    - 获取传递过来的字段
                    - 获取传递文件 request.FILES
                    - 我们使用会话技术，实现自动登录
            - 友好化
                - 注册预校验
                    - 使用ajax
                    - 后台偷偷和服务器进行交互的
                    - JSON （传输格式）
        - 展示
            - 根据用户的user_id进行判断
            - 头像，获取网络地址 url,是相对与media_root的，需要自己拼接静态路径
        - 登录
            - 验证用户名和密码
            - 密码使用的安全策略要和注册保持一致
        - 退出
            - 实际上就是清除会话信息      
    - 购物车
        - 商品和人的关系
            - 多对多的关系
            - 使用两个外键，实现关系表
            - 添加自己特定字段
                - num
                - select
        - 添加到购物车
            - 需要使用用户和商品
            - 需要获取用户的商品的唯一标识
            - 存入数据（一条购物车记录） 
                - 如果已经存在，应该是数量加 1
                - 不存在则创建
        - 数量减
            - 逻辑和加一样
            - 只不过数据为0的时候需要删除对应的数据
        - 购物车数据展示
            - 就是查询当前的用户所有商品
        - 选中状态切换
            - 将点击记录发送给服务器，进行取反操作
            - 全选，反选
                - 需要判断其他购物记录的状态
        - 下单
            - 筛选选中状态，提交给服务器
    - 订单模块
        - 订单表设计
            - 用户和订单是一个 一对多的关系
                - 表设计
                - 用户   （ForeignKey）
                - 状态
                - 订单号
                - 时间
            - 订单和购买商品信息
                - 订单和商品信息一堆多的关系
                - 表设计
                - 商品
                - 商品数量
        - 订单生成
            - 生成订单编号
            - 生成相关的商品信息
            - 移除购物车中的商品信息
        - 订单流转
            - 支付
            - 修改订单状态
            
            
            
#### 项目部署
- Linux
    - 环境安装
    - python环境（虚拟环境） 
        - 安装依赖包
        - pip install -r requirement.txt
    - mysql
    - redis
- Nginx
    - 软件安装
    - 测试启动
    - 编写配置文件 (修改location，server_name,root)
    - nginx -t -c cpath
    - http服务器   对应项目的静态资源
    - 反向解析模块
        - uwsgi_params
        - uwsgi_pass
    - 推荐大家写配置文件的时候，将配置文件放到/etc/nginx/xxx
- uwsgi
    - 先安装
    - http启动
    - 配合nginx修改未socket模式
    - 服务关闭（nginx，uwsgi）
        - 启动 nginx
        - uwsgi

             
                
                      
  